language: python
python:
  - 3.5
  #- 3.7
branches:
  only:
    - ci_test

env:
  - secure: JoQZUCDuDM8by8FQCiSYPSMjPIUGIm0u7apFAnR9WpnKI19Go00v6kojqwiVqACoegdAG8QDPgzGye2jglrktyAQ9j4txp8kKS188sVSvDygoPGT81YG5ahhrnUzam1Ea+kecA6OlErLbKjJ62v8+cEIFJ92uqUFNy1bvWf0kGnMlc5KjiKv4qJUuPH80bQJ/Abn1Q2jfAgyRvBJcMcehUq5bL3+YbCfSgMHdOj+C/DndfNLvLs1GF5dhZSprfyoR2SQQtAf+Od1J3Ri+LNectVjyeemEFYziXa2Qzmndg/z6xxyMC36jTweI25iURJ4x8uSaj4BoVTu8bn1yUkKCA==


build:
  # Custom docker image:
#  pre_ci_boot:
#    image_name: bleson_docker_repo/linux
#    image_tag: latest
#    pull: true
#    env: FOO=bar
#    options: "-e HOME=/root"
  ci:
#    - sudo apt-get install bluez-test-tools
    - sudo sed -i -- 's/#\s*deb-src/deb-src/g' /etc/apt/sources.list
    - cat /etc/apt/sources.list
    - sudo apt-get update
    - sudo apt-get build-dep bluez
    - sudo apt-get install libical-dev
    - wget http://www.kernel.org/pub/linux/bluetooth/bluez-5.43.tar.xz
    - tar xf bluez-5.43.tar.xz
    - cd bluez-5.43/
    - ./configure  --prefix=$PWD/built --enable-experimental  --enable-maintainer-mode --with-systemdsystemunitdir=/lib/systemd/system --with-systemduserunitdir=/usr/lib/systemd
    - make -j4
    - btvirt -l2 &
    - btmgmt info
    - python -m pip install setuptools twine
    - python setup.py clean build sdist publish

